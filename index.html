<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mission Cercle : Op√©ration œÄ ‚Äî Quiz (2e secondaire)</title>
  <style>
    :root {
      --glass: rgba(255,255,255,0.90);
      --glass2: rgba(255,255,255,0.78);
      --text: #0b1220;
      --muted: #334155;
      --accent: #2563eb;
      --good: #16a34a;
      --bad: #dc2626;
      --cardShadow: 0 18px 40px rgba(0,0,0,.25);
      --radius: 18px;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background: #07101d url("arriere_plan_math_cercle.png") center/cover no-repeat fixed;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 18px;
    }
    .wrap {
      width: min(980px, 100%);
      background: var(--glass);
      border-radius: var(--radius);
      box-shadow: var(--cardShadow);
      overflow: hidden;
      border: 1px solid rgba(255,255,255,.25);
      backdrop-filter: blur(10px);
    }
    header {
      padding: 18px 18px 12px 18px;
      background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.70));
      border-bottom: 1px solid rgba(15,23,42,.10);
    }
    .topRow {
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
    }
    .title {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .title h1 {
      margin: 0;
      font-size: clamp(18px, 2.2vw, 26px);
      letter-spacing: .2px;
    }
    .title .sub {
      font-size: 13px;
      color: var(--muted);
    }
    .hud {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
      align-items: center;
    }
    .pill {
      background: rgba(15,23,42,.06);
      border: 1px solid rgba(15,23,42,.10);
      padding: 8px 10px;
      border-radius: 999px;
      font-size: 13px;
      color: #0f172a;
      display: inline-flex;
      gap: 8px;
      align-items: center;
      white-space: nowrap;
    }
    .pill b { font-weight: 800; }
    .progress {
      padding: 10px 18px 16px 18px;
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      align-items: center;
    }
    .seg {
      height: 10px;
      width: 18px;
      border-radius: 999px;
      background: rgba(15,23,42,.12);
      border: 1px solid rgba(255,255,255,.22);
      position: relative;
      overflow: hidden;
    }
    .seg.current::after {
      content: "";
      position: absolute;
      inset: -2px;
      border: 2px solid rgba(37,99,235,.9);
      border-radius: 999px;
    }
    .seg.good { background: rgba(22,163,74,.85); }
    .seg.bad { background: rgba(220,38,38,.85); }
    main { padding: 18px; }
    .card {
      background: var(--glass2);
      border: 1px solid rgba(15,23,42,.10);
      border-radius: var(--radius);
      padding: 16px;
    }
    .qHead {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }
    .qNum {
      font-size: 13px;
      color: var(--muted);
    }
    .qText {
      margin: 6px 0 0 0;
      font-size: clamp(16px, 2.1vw, 20px);
      line-height: 1.25;
      font-weight: 750;
    }
    .hintBox {
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px dashed rgba(37,99,235,.35);
      background: rgba(37,99,235,.08);
      color: #0b255a;
      font-size: 14px;
      display: none;
    }
    .answers {
      margin-top: 14px;
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    .btn {
      border: 0;
      border-radius: 14px;
      padding: 12px 12px;
      text-align: left;
      font-size: 15px;
      cursor: pointer;
      background: rgba(255,255,255,.92);
      border: 1px solid rgba(15,23,42,.12);
      transition: transform .06s ease, box-shadow .06s ease;
    }
    .btn:hover { transform: translateY(-1px); }
    .btn:disabled {
      cursor: not-allowed;
      opacity: .75;
      transform: none;
    }
    .btn.good { border-color: rgba(22,163,74,.55); box-shadow: 0 0 0 3px rgba(22,163,74,.12); }
    .btn.bad { border-color: rgba(220,38,38,.55); box-shadow: 0 0 0 3px rgba(220,38,38,.12); }
    .feedback {
      margin-top: 12px;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(15,23,42,.10);
      background: rgba(255,255,255,.92);
      display: none;
      font-size: 14px;
      line-height: 1.35;
    }
    .info {
      margin-top: 10px;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(15,23,42,.10);
      background: rgba(255,255,255,.92);
      display: none;
      font-size: 14px;
      line-height: 1.35;
    }
    .controls {
      margin-top: 14px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
    }
    .leftControls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
    }
    .action {
      border: 0;
      border-radius: 999px;
      padding: 10px 14px;
      font-weight: 700;
      cursor: pointer;
      background: rgba(15,23,42,.08);
      border: 1px solid rgba(15,23,42,.12);
    }
    .action.primary {
      background: rgba(37,99,235,.92);
      border-color: rgba(37,99,235,.92);
      color: white;
    }
    .action.primary:disabled {
      background: rgba(37,99,235,.35);
      border-color: rgba(37,99,235,.35);
      cursor: not-allowed;
    }
    .fs {
      position: fixed;
      top: 14px;
      right: 14px;
      display: flex;
      gap: 10px;
      z-index: 9999;
    }
    .fs button {
      border: 0;
      border-radius: 999px;
      padding: 10px 12px;
      font-weight: 800;
      cursor: pointer;
      background: rgba(255,255,255,.88);
      border: 1px solid rgba(15,23,42,.14);
      backdrop-filter: blur(8px);
    }
    .start { padding: 22px; }
    .modeGrid {
      margin-top: 14px;
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
    }
    .modeCard {
      background: rgba(255,255,255,.92);
      border: 1px solid rgba(15,23,42,.12);
      border-radius: var(--radius);
      padding: 14px;
    }
    .modeCard h3 { margin: 0 0 6px 0; }
    .modeCard p { margin: 0; color: var(--muted); font-size: 14px; line-height: 1.3; }
    .modeCard button { margin-top: 12px; width: 100%; }
    .results { padding: 22px; }
    .resultBox {
      margin-top: 14px;
      background: rgba(255,255,255,.92);
      border: 1px solid rgba(15,23,42,.12);
      border-radius: var(--radius);
      padding: 14px;
    }
    .mistakes {
      margin-top: 12px;
      display: grid;
      gap: 10px;
    }
    .mistake {
      background: rgba(255,255,255,.92);
      border: 1px solid rgba(15,23,42,.12);
      border-radius: var(--radius);
      padding: 12px;
    }
    .mistake .meta { color: var(--muted); font-size: 13px; }
    .mistake .qt { margin: 6px 0; font-weight: 800; }
    .mistake .lines { font-size: 14px; line-height: 1.35; }
    .footerBtns {
      margin-top: 14px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    @media (max-width: 720px) {
      .modeGrid { grid-template-columns: 1fr; }
      .seg { width: 14px; }
      .fs { right: 10px; top: 10px; }
    }
  </style>
</head>
<body>
  <div class="fs">
    <button id="btnHome" title="Retour au menu">‚üµ Menu</button>
    <button id="btnEnterFs" title="Plein √©cran">‚õ∂ Plein √©cran</button>
    <button id="btnExitFs" title="Quitter" style="display:none;">üû¨ Quitter</button>
  </div>

  <div class="wrap" role="application" aria-label="Quiz math√©matiques">
    <header>
      <div class="topRow">
        <div class="title">
          <h1>Mission Cercle : Op√©ration œÄ</h1>
          <div class="sub">Math√©matiques ‚Äî 2e secondaire ‚Ä¢ Cercle, circonf√©rence, aire, œÄ</div>
        </div>
        <div class="hud" id="hud" style="display:none;">
          <div class="pill">Bonnes r√©ponses : <b id="goodCount">0</b></div>
          <div class="pill">Tentatives : <b id="tryCount">0</b></div>
          <div class="pill">Mode : <b id="modeLabel">‚Äî</b></div>
        </div>
      </div>
      <div class="progress" id="progress" style="display:none;"></div>
    </header>

    <main>
      <section id="start" class="start card">
        <div style="font-size:14px;color:var(--muted);">Choisis ton mode :</div>
        <h2 style="margin:6px 0 0 0;">Deux versions (Option C)</h2>
        <div class="modeGrid">
          <div class="modeCard">
            <h3>üß≠ Version R√©vision (guid√©e)</h3>
            <p>Questions progressives avec indices utiles, pour consolider les bases : vocabulaire, formules, unit√©s et calculs simples.</p>
            <button class="action primary" id="btnStartRev">D√©marrer ‚Äî R√©vision</button>
          </div>
          <div class="modeCard">
            <h3>üèÅ Version √âvaluation formative (plus exigeante)</h3>
            <p>Questions plus complexes : choix de formules, calculs avec valeurs approch√©es, raisonnement (rayon/diam√®tre/aire).</p>
            <button class="action primary" id="btnStartEval">D√©marrer ‚Äî √âvaluation</button>
          </div>
        </div>
        <div style="margin-top:14px;font-size:13px;color:var(--muted);">
          R√®gle : une question compte comme ¬´ bonne ¬ª seulement si elle est r√©ussie <b>du premier coup</b>.
        </div>
      </section>

      <section id="quiz" style="display:none;">
        <div class="card">
          <div class="qHead">
            <div>
              <div class="qNum" id="qNum">Question</div>
              <div class="qText" id="qText">‚Äî</div>
            </div>
          </div>

          <div class="hintBox" id="hintBox"></div>

          <div class="answers" id="answers"></div>

          <div class="feedback" id="feedback"></div>
          <div class="info" id="info"></div>

          <div class="controls">
            <div class="leftControls">
              <button class="action" id="btnHint">Indice</button>
              <button class="action" id="btnRestart">Recommencer</button>
            </div>
            <button class="action primary" id="btnNext" disabled>Passer ‚ûú</button>
          </div>
        </div>
      </section>

      <section id="results" class="results" style="display:none;">
        <div class="card">
          <h2 style="margin:0;">R√©sultats</h2>
          <div class="resultBox">
            <div style="display:flex;gap:10px;flex-wrap:wrap;">
              <div class="pill">Bonnes r√©ponses : <b id="goodFinal">0</b> / <span id="totalQ">0</span></div>
              <div class="pill">Tentatives : <b id="triesFinal">0</b></div>
              <div class="pill">Mode : <b id="modeFinal">‚Äî</b></div>
            </div>
            <div style="margin-top:10px;color:var(--muted);font-size:14px;">
              Les segments <span style="color:var(--good);font-weight:800;">verts</span> indiquent les questions r√©ussies du premier coup.
              Les segments <span style="color:var(--bad);font-weight:800;">rouges</span> indiquent une r√©ussite apr√®s au moins une erreur.
            </div>
          </div>

          <h3 style="margin:16px 0 8px 0;">R√©troactions des tentatives non r√©ussies du premier coup</h3>
          <div id="mistakes" class="mistakes"></div>

          <div class="footerBtns">
            <button class="action" id="btnCopy">Copier le rapport</button>
            <button class="action primary" id="btnBackHome">Retour au choix du mode</button>
          </div>
        </div>
      </section>
    </main>
  </div>

<script>
const DATA = {"title": "Mission Cercle : Op√©ration œÄ", "modes": {"revision": [{"q": "Quelle d√©finition correspond √† un **cercle**?", "choices": ["Une courbe ferm√©e dont tous les points sont √† √©gale distance du centre", "La r√©gion int√©rieure d‚Äôun cercle (incluant le cercle)", "Un segment qui relie deux points du cercle", "Une corde qui passe par le centre"], "correct": 0, "fb": ["‚úÖ Oui : un cercle est une **courbe** (le contour) form√©e de points √† √©gale distance du centre.", "‚ùå √áa d√©crit plut√¥t un **disque** (la surface).", "‚ùå √áa d√©crit une **corde**.", "‚ùå √áa d√©crit un **diam√®tre**."], "hint": "Indice : pense au **contour** du cercle, pas √† la surface.", "info": "Un **cercle** est le *contour* : ensemble des points situ√©s √† √©gale distance d‚Äôun **centre**. Le **disque**, lui, correspond √† la surface √† l‚Äôint√©rieur du cercle."}, {"q": "Qu‚Äôest-ce qu‚Äôun **disque**?", "choices": ["Le contour seulement", "La surface √† l‚Äôint√©rieur du cercle (incluant le contour)", "Un segment du centre au cercle", "La plus longue corde"], "correct": 1, "fb": ["‚ùå √áa, c‚Äôest le **cercle** (le contour).", "‚úÖ Exact : un disque est la **r√©gion** d√©limit√©e par le cercle.", "‚ùå √áa, c‚Äôest un **rayon**.", "‚ùå √áa, c‚Äôest un **diam√®tre**."], "hint": "Indice : pense √† une **pizza enti√®re** plut√¥t qu‚Äôau bord de la pizza.", "info": "L‚Äôaire d‚Äôun **disque** mesure la *surface* d√©limit√©e par un cercle. On l‚Äôexprime en **unit√©s carr√©es** (cm¬≤, m¬≤, etc.)."}, {"q": "Qu‚Äôest-ce qu‚Äôun **rayon**?", "choices": ["Segment reliant deux points du cercle", "Segment reliant le centre √† un point du cercle", "Corde passant par le centre", "Longueur du cercle"], "correct": 1, "fb": ["‚ùå √áa, c‚Äôest une **corde**.", "‚úÖ Oui : un rayon relie le **centre** √† un point du cercle.", "‚ùå √áa, c‚Äôest un **diam√®tre**.", "‚ùå √áa, c‚Äôest la **circonf√©rence** (p√©rim√®tre)."], "hint": "Indice : le mot rayon te rappelle une ligne qui **part du centre**.", "info": "Dans un cercle, tous les **rayons** ont la m√™me longueur (ils sont isom√©triques). Le rayon est not√© souvent **r**."}, {"q": "Quelle phrase d√©crit le mieux un **diam√®tre**?", "choices": ["Segment du centre au cercle", "Segment reliant deux points du cercle", "Corde qui passe par le centre", "Valeur de œÄ"], "correct": 2, "fb": ["‚ùå √áa, c‚Äôest un **rayon**.", "‚ùå √áa, c‚Äôest une **corde** (pas forc√©ment par le centre).", "‚úÖ Exact : un diam√®tre est une corde qui **passe par le centre**.", "‚ùå œÄ est un nombre, pas un segment."], "hint": "Indice : le diam√®tre traverse le cercle en passant par le **milieu**.", "info": "Le **diam√®tre** est la plus longue corde d‚Äôun cercle. Sa longueur vaut **deux fois** celle du rayon : d = 2r."}, {"q": "Quelle relation est correcte entre le diam√®tre **d** et le rayon **r**?", "choices": ["d = r/2", "d = 2r", "r = 2d", "r = d"], "correct": 1, "fb": ["‚ùå Si d = r/2, le diam√®tre serait plus petit que le rayon.", "‚úÖ Oui : le diam√®tre vaut **deux fois** le rayon.", "‚ùå r = 2d inverse la relation.", "‚ùå r = d n‚Äôest pas vrai (sauf r=0)."], "hint": "Indice : le diam√®tre traverse le cercle complet; le rayon n‚Äôen fait que la moiti√©.", "info": "On retient : **d = 2r** et **r = d/2**. C‚Äôest essentiel pour choisir la bonne formule."}, {"q": "Une **corde**, c‚Äôest‚Ä¶", "choices": ["Segment du centre au cercle", "Segment reliant deux points du cercle", "Corde passant par le centre", "Contour du cercle"], "correct": 1, "fb": ["‚ùå √áa, c‚Äôest un **rayon**.", "‚úÖ Oui : une corde relie **deux points du cercle**.", "‚ùå √áa, c‚Äôest un **diam√®tre**.", "‚ùå √áa, c‚Äôest le **cercle**."], "hint": "Indice : une corde relie deux points du **contour**.", "info": "Le **diam√®tre** est une corde particuli√®re : il passe par le centre et c‚Äôest la **plus longue** corde."}, {"q": "La **circonf√©rence** d‚Äôun cercle correspond √†‚Ä¶", "choices": ["La surface du disque", "Le p√©rim√®tre du cercle", "La longueur d‚Äôun rayon", "Le double du diam√®tre"], "correct": 1, "fb": ["‚ùå La surface, c‚Äôest l‚Äô**aire**.", "‚úÖ Exact : c‚Äôest la **longueur du contour** (le p√©rim√®tre).", "‚ùå Un rayon est un segment, pas la longueur du contour.", "‚ùå Le double du diam√®tre n‚Äôest pas une d√©finition."], "hint": "Indice : circonf√©rence = **tour complet** du cercle.", "info": "La circonf√©rence se note **C** et se mesure en unit√©s de longueur (cm, m‚Ä¶)."}, {"q": "Quelle formule permet de calculer la circonf√©rence C √† partir du rayon r?", "choices": ["C = œÄr¬≤", "C = 2œÄr", "C = œÄr", "C = 2r"], "correct": 1, "fb": ["‚ùå œÄr¬≤ est une **aire**.", "‚úÖ Oui : **C = 2œÄr**.", "‚ùå œÄr oublie le facteur 2.", "‚ùå 2r est le **diam√®tre**."], "hint": "Indice : avec le rayon, la circonf√©rence contient **2œÄ**.", "info": "Deux formules : **C = 2œÄr** ou **C = œÄd**. Choisis selon la donn√©e."}, {"q": "Quelle formule permet de calculer la circonf√©rence C √† partir du diam√®tre d?", "choices": ["C = œÄd", "C = 2œÄd", "C = œÄd¬≤", "C = d/œÄ"], "correct": 0, "fb": ["‚úÖ Exact : **C = œÄd**.", "‚ùå 2œÄd est trop grand.", "‚ùå œÄd¬≤ n‚Äôest pas une circonf√©rence.", "‚ùå d/œÄ sert √† trouver d si on conna√Æt C."], "hint": "Indice : avec le diam√®tre, c‚Äôest simplement œÄ √ó d.", "info": "Comme d = 2r, **C = œÄd** et **C = 2œÄr** sont √©quivalentes."}, {"q": "Quelle √©galit√© exprime le rapport constant entre circonf√©rence et diam√®tre?", "choices": ["œÄ = C/d", "œÄ = d/C", "œÄ = C/2r¬≤", "œÄ = r/C"], "correct": 0, "fb": ["‚úÖ Oui : œÄ = C/d.", "‚ùå Tu as invers√© le rapport.", "‚ùå 2r¬≤ n‚Äôa pas de lien ici.", "‚ùå r/C n‚Äôest pas constant."], "hint": "Indice : pense ‚Äúcirconf√©rence √∑ diam√®tre‚Äù.", "info": "On obtient toujours **œÄ** quand on divise la circonf√©rence par le diam√®tre : œÄ = C/d. Aussi : œÄ = C/(2r)."}, {"q": "Un cercle a un rayon de 6 cm. Quelle est sa circonf√©rence **exacte**?", "choices": ["12œÄ cm", "36œÄ cm", "6œÄ cm", "3œÄ cm"], "correct": 0, "fb": ["‚úÖ Exact : C = 2œÄ√ó6 = **12œÄ cm**.", "‚ùå 36œÄ est trop grand.", "‚ùå 6œÄ oublie le facteur 2.", "‚ùå 3œÄ est trop petit."], "hint": "Indice : C = 2œÄr et r = 6.", "info": "C = 2œÄr. Avec r = 6 cm ‚Üí C = 12œÄ cm (‚âà 37,7 cm si œÄ‚âà3,14)."}, {"q": "Un cercle a un diam√®tre de 10 m. Quelle est sa circonf√©rence **exacte**?", "choices": ["10œÄ m", "5œÄ m", "20œÄ m", "100œÄ m"], "correct": 0, "fb": ["‚úÖ Oui : C = œÄ√ó10 = **10œÄ m**.", "‚ùå 5œÄ serait si d=5.", "‚ùå 20œÄ confond avec 2œÄd.", "‚ùå 100œÄ est une erreur de puissance."], "hint": "Indice : C = œÄd.", "info": "C = œÄd. Avec d=10 m ‚Üí C = 10œÄ m (‚âà 31,4 m si œÄ‚âà3,14)."}, {"q": "Si on conna√Æt la circonf√©rence C, comment trouver le rayon r?", "choices": ["r = C/œÄ", "r = C/(2œÄ)", "r = 2œÄ/C", "r = œÄ/C"], "correct": 1, "fb": ["‚ùå C/œÄ donne le diam√®tre.", "‚úÖ Exact : r = C/(2œÄ).", "‚ùå 2œÄ/C inverse la relation.", "‚ùå œÄ/C n‚Äôest pas correct."], "hint": "Indice : pars de C = 2œÄr et isole r.", "info": "√Ä partir de C = 2œÄr, on divise par 2œÄ : **r = C/(2œÄ)**."}, {"q": "Si on conna√Æt la circonf√©rence C, comment trouver le diam√®tre d?", "choices": ["d = C/œÄ", "d = C/(2œÄ)", "d = œÄ/C", "d = 2C/œÄ"], "correct": 0, "fb": ["‚úÖ Oui : d = C/œÄ.", "‚ùå C/(2œÄ) donne le rayon.", "‚ùå œÄ/C inverse le rapport.", "‚ùå 2C/œÄ donnerait 2d."], "hint": "Indice : pars de C = œÄd.", "info": "√Ä partir de C = œÄd, on obtient **d = C/œÄ**. Ensuite r = d/2."}, {"q": "Quelle formule donne l‚Äôaire A d‚Äôun disque de rayon r?", "choices": ["A = 2œÄr", "A = œÄr¬≤", "A = œÄd", "A = 2r¬≤"], "correct": 1, "fb": ["‚ùå 2œÄr est une circonf√©rence.", "‚úÖ Exact : **A = œÄr¬≤**.", "‚ùå œÄd est une circonf√©rence.", "‚ùå 2r¬≤ n‚Äôinclut pas œÄ."], "hint": "Indice : l‚Äôaire implique un **carr√©** (r¬≤).", "info": "L‚Äôaire d‚Äôun disque se mesure en unit√©s carr√©es. Formule : **A = œÄr¬≤**."}, {"q": "Un disque a un rayon de 5 cm. Quelle est son aire **exacte**?", "choices": ["25œÄ cm¬≤", "10œÄ cm¬≤", "5œÄ cm¬≤", "50œÄ cm¬≤"], "correct": 0, "fb": ["‚úÖ Oui : A = œÄ√ó5¬≤ = **25œÄ cm¬≤**.", "‚ùå 10œÄ oublie le carr√©.", "‚ùå 5œÄ oublie le carr√©.", "‚ùå 50œÄ multiplie par 2 sans raison."], "hint": "Indice : calcule d‚Äôabord 5¬≤.", "info": "A = œÄr¬≤. r=5 ‚Üí r¬≤=25 ‚Üí A = 25œÄ cm¬≤ (‚âà 78,5 cm¬≤ si œÄ‚âà3,14)."}, {"q": "Quelles unit√©s sont correctes?", "choices": ["C en cm¬≤ et A en cm", "C en cm et A en cm¬≤", "C en cm¬≥ et A en cm¬≤", "C en cm et A en cm"], "correct": 1, "fb": ["‚ùå Tu as invers√©.", "‚úÖ Exact : C est une longueur; A est une surface.", "‚ùå cm¬≥ est une unit√© de volume.", "‚ùå A n‚Äôest pas une longueur."], "hint": "Indice : p√©rim√®tre = longueur; aire = surface.", "info": "Circonf√©rence ‚Üí unit√©s de longueur. Aire ‚Üí unit√©s carr√©es (cm¬≤, m¬≤‚Ä¶)."}, {"q": "Quelle valeur approch√©e de œÄ utilise-t-on souvent au secondaire?", "choices": ["œÄ ‚âà 0,314", "œÄ ‚âà 3,14", "œÄ ‚âà 31,4", "œÄ ‚âà 1,34"], "correct": 1, "fb": ["‚ùå 0,314 est 10√ó trop petit.", "‚úÖ Oui : œÄ ‚âà 3,14 (ou 3,1416).", "‚ùå 31,4 est 10√ó trop grand.", "‚ùå 1,34 est incorrect."], "hint": "Indice : œÄ est un peu plus grand que 3.", "info": "œÄ est irrationnel (d√©cimales infinies sans p√©riode). On utilise souvent 3,14 ou 3,1416."}, {"q": "Dans un cercle, combien de rayons diff√©rents peut-on tracer?", "choices": ["Un seul", "Deux", "Une infinit√©", "Dix"], "correct": 2, "fb": ["‚ùå On peut en tracer autant qu‚Äôon veut.", "‚ùå Deux est trop petit.", "‚úÖ Oui : on peut tracer une infinit√© de rayons.", "‚ùå Dix n‚Äôest pas une limite."], "hint": "Indice : il y a une infinit√© de points sur un cercle.", "info": "Chaque point du cercle peut √™tre reli√© au centre : cela donne une **infinit√©** de rayons, tous de m√™me longueur."}, {"q": "Dans un cercle, que peut-on dire des diam√®tres?", "choices": ["Tous les diam√®tres ont la m√™me longueur", "Les diam√®tres ont toujours des longueurs diff√©rentes", "Le diam√®tre est plus court que le rayon", "Le diam√®tre ne passe jamais par le centre"], "correct": 0, "fb": ["‚úÖ Exact : tous les diam√®tres d‚Äôun m√™me cercle sont isom√©triques.", "‚ùå Faux : ils ont tous la m√™me longueur.", "‚ùå Faux : d = 2r donc d > r.", "‚ùå Faux : un diam√®tre passe par le centre."], "hint": "Indice : dans un cercle donn√©, r est unique, donc d aussi.", "info": "Comme tous les rayons sont √©gaux, et d = 2r, tous les diam√®tres d‚Äôun m√™me cercle ont la m√™me longueur."}], "evaluation": [{"q": "Quelle affirmation est vraie?", "choices": ["Le cercle est la surface, le disque est le contour", "Le cercle est le contour, le disque est la surface", "Cercle et disque sont identiques", "Le disque est une corde"], "correct": 1, "fb": ["‚ùå Invers√©.", "‚úÖ Correct : cercle = contour; disque = surface.", "‚ùå Non : ils sont li√©s mais diff√©rents.", "‚ùå Non : une corde est un segment."], "hint": "Indice : bord vs surface.", "info": "**Cercle** : contour. **Disque** : surface d√©limit√©e par le cercle."}, {"q": "On conna√Æt le **diam√®tre** d‚Äôun cercle et on veut sa circonf√©rence. Quelle formule choisit-on?", "choices": ["A = œÄr¬≤", "C = 2œÄr", "C = œÄd", "d = 2r"], "correct": 2, "fb": ["‚ùå A = œÄr¬≤ est une aire.", "‚ùå C = 2œÄr demande r.", "‚úÖ Oui : si tu connais d, la formule directe est C = œÄd.", "‚ùå d = 2r relie d et r, mais ne calcule pas C."], "hint": "Indice : cherche une formule avec d et C.", "info": "Si le diam√®tre est connu, la circonf√©rence se calcule par **C = œÄd**."}, {"q": "Un cercle a un diam√®tre de 6 cm. En prenant œÄ ‚âà 3,14, quelle est sa circonf√©rence?", "choices": ["C ‚âà 18,84 cm", "C ‚âà 9,42 cm", "C ‚âà 6,28 cm", "C ‚âà 37,68 cm"], "correct": 0, "fb": ["‚úÖ Oui : C ‚âà 3,14√ó6 = 18,84 cm.", "‚ùå Tu as divis√© au lieu de multiplier.", "‚ùå Cette valeur correspond √† 2œÄ avec r=1.", "‚ùå Tu as multipli√© par 12."], "hint": "Indice : calcule 3,14 √ó 6.", "info": "C = œÄd. Avec d=6 cm ‚Üí C ‚âà 18,84 cm."}, {"q": "Un cercle a une circonf√©rence de 25,12 cm (œÄ ‚âà 3,14). Quel est son rayon?", "choices": ["r ‚âà 4 cm", "r ‚âà 8 cm", "r ‚âà 2 cm", "r ‚âà 12,56 cm"], "correct": 0, "fb": ["‚úÖ Oui : r = C/(2œÄ) ‚âà 25,12/6,28 ‚âà 4 cm.", "‚ùå 8 cm est le diam√®tre.", "‚ùå 2 cm donnerait C‚âà12,56 cm.", "‚ùå 12,56 cm confond avec œÄ√ó4."], "hint": "Indice : calcule d = C/œÄ puis r = d/2.", "info": "d = C/œÄ ‚âà 8 cm, donc r = 4 cm."}, {"q": "Un disque a un diam√®tre de 12 cm. Quelle est son aire exacte?", "choices": ["A = 36œÄ cm¬≤", "A = 18œÄ cm¬≤", "A = 9œÄ cm¬≤", "A = 12œÄ cm¬≤"], "correct": 0, "fb": ["‚úÖ Oui : r=6, donc A = œÄ√ó6¬≤ = 36œÄ cm¬≤.", "‚ùå Erreur sur le rayon ou sur le carr√©.", "‚ùå Correspond √† r=3.", "‚ùå Ne correspond pas √† A = œÄr¬≤."], "hint": "Indice : commence par r = d/2.", "info": "Si d=12, r=6. Aire : A = œÄr¬≤ = 36œÄ cm¬≤."}, {"q": "Laquelle est vraie?", "choices": ["Toute corde est un diam√®tre", "Tout diam√®tre est une corde", "Une corde passe toujours par le centre", "Le diam√®tre n‚Äôest pas une corde"], "correct": 1, "fb": ["‚ùå Faux : une corde ne passe pas toujours par le centre.", "‚úÖ Exact : un diam√®tre est un cas particulier de corde.", "‚ùå Faux : seulement le diam√®tre passe par le centre.", "‚ùå Faux : le diam√®tre est une corde."], "hint": "Indice : ‚Äúdiam√®tre = corde sp√©ciale‚Äù.", "info": "Une corde relie deux points du cercle. Le diam√®tre est une corde qui passe par le centre."}, {"q": "√Ä propos de œÄ, quelle phrase est correcte?", "choices": ["œÄ est rationnel car on peut l‚Äô√©crire 22/7 exactement", "œÄ est irrationnel : ses d√©cimales ne se terminent pas et ne se r√©p√®tent pas", "œÄ vaut exactement 3,14", "œÄ est un entier"], "correct": 1, "fb": ["‚ùå 22/7 est une approximation.", "‚úÖ Oui : œÄ est irrationnel.", "‚ùå 3,14 est une approximation.", "‚ùå œÄ n‚Äôest pas un entier."], "hint": "Indice : irrationnel = pas d‚Äô√©criture d√©cimale finie ni p√©riodique.", "info": "œÄ est irrationnel. On utilise des approximations (3,14; 3,1416; 22/7) pour calculer."}, {"q": "Quelle affirmation sur les unit√©s est correcte?", "choices": ["La circonf√©rence mesure une surface", "L‚Äôaire mesure une longueur", "La circonf√©rence se mesure en unit√©s de longueur", "L‚Äôaire se mesure en unit√©s de longueur"], "correct": 2, "fb": ["‚ùå Non : une surface correspond √† une aire.", "‚ùå Non : l‚Äôaire se mesure en unit√©s carr√©es.", "‚úÖ Oui : la circonf√©rence est une longueur.", "‚ùå Non : l‚Äôaire n‚Äôest pas une longueur."], "hint": "Indice : p√©rim√®tre = longueur.", "info": "Circonf√©rence ‚Üí longueur. Aire ‚Üí unit√©s carr√©es."}, {"q": "Un disque a une aire de 49œÄ cm¬≤. Quel est son rayon?", "choices": ["r = 7 cm", "r = 49 cm", "r = ‚àö49 cm", "r = 14 cm"], "correct": 0, "fb": ["‚úÖ Oui : r¬≤ = 49 ‚Üí r = 7 cm.", "‚ùå 49 cm est r¬≤, pas r.", "‚ùå ‚àö49 = 7 : c‚Äôest vrai, mais la forme simple est 7 cm.", "‚ùå 14 cm donnerait 196œÄ."], "hint": "Indice : divise par œÄ puis prends la racine carr√©e.", "info": "A = œÄr¬≤ ‚Üí r¬≤ = A/œÄ = 49 ‚Üí r = 7."}, {"q": "Si on te demande une circonf√©rence **exacte** pour d = 10 cm, quelle r√©ponse est la meilleure?", "choices": ["Garder 10œÄ cm", "√âcrire 31,4 cm", "√âcrire 3,14 cm", "√âcrire 10 cm"], "correct": 0, "fb": ["‚úÖ Oui : 10œÄ cm est exact.", "‚ùå 31,4 cm est une approximation.", "‚ùå 3,14 cm ne tient pas compte du diam√®tre.", "‚ùå 10 cm est le diam√®tre, pas la circonf√©rence."], "hint": "Indice : ‚Äúexact‚Äù = garder œÄ.", "info": "Exact ‚Üí garder œÄ. Approximation ‚Üí remplacer œÄ par 3,14 ou 3,1416."}, {"q": "Quelle affirmation est vraie dans un cercle?", "choices": ["Le rayon est la plus longue corde", "Le diam√®tre est la plus longue corde", "Une corde est toujours plus longue qu‚Äôun diam√®tre", "Le diam√®tre est plus court qu‚Äôun rayon"], "correct": 1, "fb": ["‚ùå Le rayon n‚Äôest pas une corde.", "‚úÖ Oui : le diam√®tre est la plus longue corde.", "‚ùå Aucune corde n‚Äôest plus longue que le diam√®tre.", "‚ùå d = 2r, donc d > r."], "hint": "Indice : d = 2r.", "info": "Le diam√®tre traverse le cercle en passant par le centre : c‚Äôest la corde maximale."}, {"q": "Un disque a un rayon de 8 m. Quelle est son aire exacte?", "choices": ["16œÄ m¬≤", "64œÄ m¬≤", "8œÄ m¬≤", "128œÄ m¬≤"], "correct": 1, "fb": ["‚ùå 16œÄ correspond √† r=4.", "‚úÖ A = œÄ√ó8¬≤ = **64œÄ m¬≤**.", "‚ùå 8œÄ oublie le carr√©.", "‚ùå 128œÄ multiplie par 2 sans raison."], "hint": "Indice : r¬≤ = 8¬≤.", "info": "A = œÄr¬≤. r=8 ‚Üí A = 64œÄ m¬≤."}, {"q": "Un cercle a une circonf√©rence de 31,4 m (œÄ‚âà3,14). Quel est son diam√®tre?", "choices": ["10 m", "5 m", "20 m", "31,4 m"], "correct": 0, "fb": ["‚úÖ d = C/œÄ ‚âà 10 m.", "‚ùå 5 m est le rayon si d=10.", "‚ùå 20 m serait si C‚âà62,8.", "‚ùå 31,4 m confond circonf√©rence et diam√®tre."], "hint": "Indice : d = C/œÄ.", "info": "√Ä partir de C = œÄd, on obtient d = C/œÄ. Ici : 31,4/3,14 = 10."}, {"q": "Quelle formule permet de trouver le rayon r √† partir du diam√®tre d?", "choices": ["r = 2d", "r = d/2", "r = d¬≤", "r = œÄd"], "correct": 1, "fb": ["‚ùå 2d rendrait r > d.", "‚úÖ Oui : r = d/2.", "‚ùå d¬≤ change les unit√©s.", "‚ùå œÄd sert √† la circonf√©rence."], "hint": "Indice : le rayon est la moiti√© du diam√®tre.", "info": "d = 2r ‚Üí r = d/2."}, {"q": "Un cercle a un rayon de 3,5 dm. Avec œÄ‚âà3,14, quelle est sa circonf√©rence?", "choices": ["‚âà 10,99 dm", "‚âà 21,98 dm", "‚âà 7,00 dm", "‚âà 3,14 dm"], "correct": 1, "fb": ["‚ùå Il manque le facteur 2.", "‚úÖ C = 2œÄr ‚âà 6,28√ó3,5 = **21,98 dm**.", "‚ùå 7,00 dm est le diam√®tre, pas C.", "‚ùå œÄ seul n‚Äôest pas une circonf√©rence."], "hint": "Indice : calcule 2œÄ ‚âà 6,28.", "info": "C = 2œÄr. 2œÄ‚âà6,28; 6,28√ó3,5‚âà21,98."}, {"q": "Un disque a une aire de 100œÄ mm¬≤. Quel est son rayon?", "choices": ["10 mm", "100 mm", "50 mm", "5 mm"], "correct": 0, "fb": ["‚úÖ r¬≤=100 ‚Üí r=10 mm.", "‚ùå 100 mm est r¬≤.", "‚ùå 50 mm ne convient pas.", "‚ùå 5 mm donnerait 25œÄ."], "hint": "Indice : r = ‚àö(A/œÄ).", "info": "A=œÄr¬≤ ‚Üí r¬≤=100 ‚Üí r=10."}, {"q": "Pour un cercle, quel rapport donne toujours œÄ?", "choices": ["C √∑ r", "C √∑ d", "d √∑ C", "r √∑ C"], "correct": 1, "fb": ["‚ùå C/r vaut 2œÄ.", "‚úÖ C/d vaut œÄ.", "‚ùå d/C vaut 1/œÄ.", "‚ùå r/C d√©pend du cercle."], "hint": "Indice : œÄ = C/d.", "info": "Le rapport **circonf√©rence √∑ diam√®tre** est constant et vaut œÄ."}, {"q": "Pour un cercle, quel rapport donne toujours œÄ?", "choices": ["C √∑ r", "C √∑ d", "d √∑ C", "r √∑ C"], "correct": 1, "fb": ["‚ùå C/r vaut 2œÄ.", "‚úÖ C/d vaut œÄ.", "‚ùå d/C vaut 1/œÄ.", "‚ùå r/C d√©pend du cercle."], "hint": "Indice : œÄ = C/d.", "info": "Le rapport **circonf√©rence √∑ diam√®tre** est constant et vaut œÄ."}, {"q": "Pour un cercle, quel rapport donne toujours œÄ?", "choices": ["C √∑ r", "C √∑ d", "d √∑ C", "r √∑ C"], "correct": 1, "fb": ["‚ùå C/r vaut 2œÄ.", "‚úÖ C/d vaut œÄ.", "‚ùå d/C vaut 1/œÄ.", "‚ùå r/C d√©pend du cercle."], "hint": "Indice : œÄ = C/d.", "info": "Le rapport **circonf√©rence √∑ diam√®tre** est constant et vaut œÄ."}, {"q": "Pour un cercle, quel rapport donne toujours œÄ?", "choices": ["C √∑ r", "C √∑ d", "d √∑ C", "r √∑ C"], "correct": 1, "fb": ["‚ùå C/r vaut 2œÄ.", "‚úÖ C/d vaut œÄ.", "‚ùå d/C vaut 1/œÄ.", "‚ùå r/C d√©pend du cercle."], "hint": "Indice : œÄ = C/d.", "info": "Le rapport **circonf√©rence √∑ diam√®tre** est constant et vaut œÄ."}]}};

const els = {
  start: document.getElementById('start'),
  quiz: document.getElementById('quiz'),
  results: document.getElementById('results'),
  hud: document.getElementById('hud'),
  progress: document.getElementById('progress'),
  modeLabel: document.getElementById('modeLabel'),
  qNum: document.getElementById('qNum'),
  qText: document.getElementById('qText'),
  answers: document.getElementById('answers'),
  hintBox: document.getElementById('hintBox'),
  feedback: document.getElementById('feedback'),
  info: document.getElementById('info'),
  btnHint: document.getElementById('btnHint'),
  btnRestart: document.getElementById('btnRestart'),
  btnNext: document.getElementById('btnNext'),
  goodCount: document.getElementById('goodCount'),
  tryCount: document.getElementById('tryCount'),
  goodFinal: document.getElementById('goodFinal'),
  triesFinal: document.getElementById('triesFinal'),
  totalQ: document.getElementById('totalQ'),
  modeFinal: document.getElementById('modeFinal'),
  mistakes: document.getElementById('mistakes'),
  btnCopy: document.getElementById('btnCopy'),
  btnBackHome: document.getElementById('btnBackHome'),
  btnStartRev: document.getElementById('btnStartRev'),
  btnStartEval: document.getElementById('btnStartEval'),
  btnEnterFs: document.getElementById('btnEnterFs'),
  btnExitFs: document.getElementById('btnExitFs'),
  btnHome: document.getElementById('btnHome')
};

let mode = null;
let questions = [];
let qIndex = 0;

let goodFirstTry = 0;
let totalTries = 0;

let progressState = [];
let currentTriesThisQ = 0;
let lockedCorrect = false;

let attemptLog = []; // logs wrong attempts only

function shuffle(arr) {
  const a = arr.slice();
  for (let i=a.length-1;i>0;i--) {
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]] = [a[j],a[i]];
  }
  return a;
}

function renderProgress() {
  els.progress.innerHTML = '';
  for (let i=0;i<questions.length;i++) {
    const d = document.createElement('div');
    d.className = 'seg';
    if (progressState[i]==='good') d.classList.add('good');
    if (progressState[i]==='bad') d.classList.add('bad');
    if (i===qIndex) d.classList.add('current');
    els.progress.appendChild(d);
  }
}

function resetPerQuestion() {
  currentTriesThisQ = 0;
  lockedCorrect = false;
  els.btnNext.disabled = true;
  els.feedback.style.display = 'none';
  els.info.style.display = 'none';
  els.hintBox.style.display = 'none';
}

function start(selectedMode) {
  mode = selectedMode;
  questions = DATA.modes[mode].map((qq, idx) => ({...qq, idx}));
  qIndex = 0;
  goodFirstTry = 0;
  totalTries = 0;
  progressState = Array(questions.length).fill(null);
  attemptLog = [];

  els.modeLabel.textContent = (mode === 'revision') ? 'R√©vision' : '√âvaluation';
  els.hud.style.display = '';
  els.progress.style.display = '';
  els.start.style.display = 'none';
  els.results.style.display = 'none';
  els.quiz.style.display = '';
  els.totalQ.textContent = String(questions.length);

  renderProgress();
  loadQuestion();
  updateHud();
}

function updateHud() {
  els.goodCount.textContent = String(goodFirstTry);
  els.tryCount.textContent = String(totalTries);
}

function loadQuestion() {
  resetPerQuestion();
  const qq = questions[qIndex];
  els.qNum.textContent = `Question ${qIndex+1} / ${questions.length}`;
  els.qText.innerHTML = qq.q.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');

  const packed = qq.choices.map((t,i)=>({t, i}));
  const shuffled = shuffle(packed);
  const map = shuffled.map(x=>x.i);

  els.answers.innerHTML = '';
  shuffled.forEach((item, displayIdx) => {
    const btn = document.createElement('button');
    btn.className = 'btn';
    btn.innerHTML = item.t.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
    btn.addEventListener('click', () => handleAnswer(displayIdx, map));
    els.answers.appendChild(btn);
  });

  els.btnHint.onclick = () => {
    els.hintBox.textContent = qq.hint;
    els.hintBox.style.display = '';
  };

  els.btnRestart.onclick = () => start(mode);
  els.btnNext.onclick = () => nextQuestion();

  renderProgress();
}

function handleAnswer(displayIdx, map) {
  if (lockedCorrect) return;

  const qq = questions[qIndex];
  const originalIdx = map[displayIdx];

  currentTriesThisQ += 1;
  totalTries += 1;
  updateHud();

  const btns = Array.from(els.answers.querySelectorAll('button'));
  btns.forEach(b => b.classList.remove('good','bad'));
  const selectedBtn = btns[displayIdx];

  const fbText = qq.fb[originalIdx];
  els.feedback.innerHTML = fbText;
  els.feedback.style.display = '';

  if (originalIdx === qq.correct) {
    lockedCorrect = true;

    if (currentTriesThisQ === 1) {
      goodFirstTry += 1;
      progressState[qIndex] = 'good';
    } else {
      progressState[qIndex] = 'bad';
    }

    selectedBtn.classList.add('good');
    els.info.innerHTML = `<b>√Ä retenir :</b> ${qq.info}`;
    els.info.style.display = '';
    els.btnNext.disabled = false;

  } else {
    selectedBtn.classList.add('bad');
    attemptLog.push({
      index: qIndex,
      chosenText: qq.choices[originalIdx],
      feedbackText: fbText
    });
  }

  renderProgress();
}

function nextQuestion() {
  if (!lockedCorrect) return;
  qIndex += 1;
  if (qIndex >= questions.length) finish();
  else loadQuestion();
}

function stripMd(s) {
  return String(s).replace(/\*\*(.*?)\*\*/g, '$1').replace(/<[^>]+>/g, '');
}

function finish() {
  els.quiz.style.display = 'none';
  els.results.style.display = '';
  els.goodFinal.textContent = String(goodFirstTry);
  els.triesFinal.textContent = String(totalTries);
  els.modeFinal.textContent = (mode === 'revision') ? 'R√©vision' : '√âvaluation';

  const wrongCounts = {};
  attemptLog.forEach(a => wrongCounts[a.index] = (wrongCounts[a.index]||0) + 1);

  els.mistakes.innerHTML = '';
  if (attemptLog.length === 0) {
    const div = document.createElement('div');
    div.className = 'mistake';
    div.innerHTML = `<div class="qt">Aucune tentative erron√©e üéâ</div><div class="lines">Tu as tout r√©ussi du premier coup. Excellent travail!</div>`;
    els.mistakes.appendChild(div);
  } else {
    const grouped = new Map();
    attemptLog.forEach(a => {
      if (!grouped.has(a.index)) grouped.set(a.index, []);
      grouped.get(a.index).push(a);
    });

    Array.from(grouped.entries()).sort((a,b)=>a[0]-b[0]).forEach(([idx, arr]) => {
      const qq = questions[idx];
      const tries = (wrongCounts[idx]||0) + 1;

      const div = document.createElement('div');
      div.className = 'mistake';

      const qtxt = qq.q.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
      const lines = arr.map((x, k) => {
        const chosen = x.chosenText.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
        return `<div class="lines"><b>Choix ${k+1} :</b> ${chosen}<br>${x.feedbackText}</div>`;
      }).join('<hr style="border:none;border-top:1px solid rgba(15,23,42,.10);margin:10px 0;">');

      const correct = qq.choices[qq.correct].replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
      div.innerHTML = `
        <div class="meta">Question ${idx+1} ‚Ä¢ Tentatives : <b>${tries}</b></div>
        <div class="qt">${qtxt}</div>
        ${lines}
        <hr style="border:none;border-top:1px solid rgba(15,23,42,.10);margin:10px 0;">
        <div class="lines"><b>Bonne r√©ponse :</b> ${correct}</div>
        <div class="lines" style="margin-top:6px;"><b>√Ä retenir :</b> ${qq.info}</div>
      `;
      els.mistakes.appendChild(div);
    });
  }

  els.btnCopy.onclick = async () => {
    const report = buildReportText();
    try {
      await navigator.clipboard.writeText(report);
      els.btnCopy.textContent = "‚úÖ Rapport copi√©";
      setTimeout(()=>els.btnCopy.textContent="Copier le rapport", 1400);
    } catch(e) {
      alert("Impossible de copier automatiquement. S√©lectionne et copie manuellement.\n\n" + report);
    }
  };

  els.btnBackHome.onclick = () => {
    els.results.style.display = 'none';
    els.hud.style.display = 'none';
    els.progress.style.display = 'none';
    els.start.style.display = '';
  };
}

function buildReportText() {
  const modeName = (mode === 'revision') ? 'R√©vision' : '√âvaluation';
  let txt = `Mission Cercle : Op√©ration œÄ ‚Äî R√©sultats
`;
  txt += `Mode : ${modeName}
`;
  txt += `Bonnes r√©ponses : ${goodFirstTry}/${questions.length} (du premier coup)
`;
  txt += `Tentatives : ${totalTries}

`;

  if (attemptLog.length === 0) {
    txt += "Aucune tentative erron√©e.\n";
    return txt;
  }

  const grouped = new Map();
  attemptLog.forEach(a => {
    if (!grouped.has(a.index)) grouped.set(a.index, []);
    grouped.get(a.index).push(a);
  });

  txt += "R√©troactions (tentatives non r√©ussies du premier coup) :\n\n";
  Array.from(grouped.entries()).sort((a,b)=>a[0]-b[0]).forEach(([idx, arr]) => {
    const qq = questions[idx];
    txt += `Question ${idx+1}
`;
    txt += `Q : ${stripMd(qq.q)}
`;
    arr.forEach((x,k) => {
      txt += `  Choix ${k+1} : ${stripMd(x.chosenText)}
`;
      txt += `  ${stripMd(x.feedbackText)}
`;
    });
    txt += `  Bonne r√©ponse : ${stripMd(qq.choices[qq.correct])}
`;
    txt += `  √Ä retenir : ${stripMd(qq.info)}

`;
  });

  return txt;
}


// Retour au menu principal (accessible en tout temps)
els.btnHome.onclick = () => {
  // R√©initialise l'affichage vers l'√©cran d'accueil (choix du mode)
  els.quiz.style.display = 'none';
  els.results.style.display = 'none';
  els.hud.style.display = 'none';
  els.progress.style.display = 'none';
  els.start.style.display = '';
};

// Start buttons
els.btnStartRev.onclick = ()=>start('revision');
els.btnStartEval.onclick = ()=>start('evaluation');

// Fullscreen
function isFs() { return !!document.fullscreenElement; }
els.btnEnterFs.onclick = async () => {
  try { await document.documentElement.requestFullscreen(); }
  catch(e) { alert("Le plein √©cran n'est pas disponible dans ce navigateur."); }
};
els.btnExitFs.onclick = async () => {
  try { await document.exitFullscreen(); } catch(e) {}
};
document.addEventListener('fullscreenchange', () => {
  if (isFs()) {
    els.btnEnterFs.style.display = 'none';
    els.btnExitFs.style.display = '';
  } else {
    els.btnEnterFs.style.display = '';
    els.btnExitFs.style.display = 'none';
  }
});
</script>
</body>
</html>
